function makerho_update_PBC(L,Jmaxpos_vec,chi_inc,sweep,optmax,ULmax,slow,epsilon,sweepmax,h_full)
%makerho_update_PBC(L,Jmaxpos_vec,chi_inc,sweep,optmax,ULmax,slow,epsilon,sweepmax,h_full)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% dMERA - makerho_update_PBC
% contracts down to create projectors, updating on the way down
% 
% Andrew Goldsborough - 22/11/2016
% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

global w u rho h VMDH;

%contraction orders from netcon
rho_l_order = {[-1,-2,6,5],[5,-4,3,4],[3,1],[6,-3,2,4],[2,1]};
rho_m1_order = {[6,12,5,4],[12,-2,13,14],[13,1],[1,10,4,3],[14,-4,10,11],[8,-3,9,11],[6,-1,7,8],[7,2],[2,9,5,3]};
rho_m2_order = {[6,8,5,4],[8,10,9,13],[9,1],[1,14,4,3],[13,-2,14,-4],[11,-1,12,-3],[6,10,7,11],[7,2],[2,12,5,3]};
rho_m3_order = {[5,4,7,12],[4,3,1,10],[1,13],[13,14,12,-4],[10,11,14,-2],[8,11,9,-1],[5,3,2,8],[2,6],[6,9,7,-3]};
rho_r_order = {[6,5,-3,-4],[1,3],[3,4,5,-2],[2,4,6,-1],[1,2]};
rho_l_inc_order = {[-1,-2,3,2],[2,-4,1],[3,-3,1]};
rho_m1_inc_order = {[4,9,3,2],[9,-2,10],[2,7,1],[10,-4,7,8],[5,-3,6,8],[4,-1,5],[3,6,1]};
rho_m2_inc_order = {[6,5,4,3],[5,1,9],[3,10,2],[9,-2,10,-4],[7,-1,8,-3],[6,1,7],[4,8,2]};
rho_m3_inc_order = {[3,2,4,9],[2,1,7],[9,10,-4],[7,8,10,-2],[5,8,6,-1],[3,1,5],[4,6,-3]};
rho_r_inc_order = {[3,2,-3,-4],[2,1,-2],[3,1,-1]};
rho_at1_order = {[3,2],[1,4],[4,5,3,7],[2,8,1,6],[7,-4,8,17],[6,18,5,-2],[15,-3,16,17],[14,18,13,-1],[12,13,11,15],[10,16,9,14],[11,10],[9,12]};
rho_at2_order = {[3,2],[1,4],[4,9,3,13],[2,14,1,10],[13,-2,14,-4],[11,-1,12,-3],[8,9,7,11],[6,12,5,10],[7,6],[5,8]};
rho_at3_order = {[3,2],[1,4],[4,5,3,7],[2,8,1,6],[7,18,8,-2],[6,-4,5,17],[15,18,16,-1],[14,-3,13,17],[12,13,11,15],[10,16,9,14],[11,10],[9,12]};
rho_at4_order = {[3,2],[1,4],[4,13,3,9],[2,10,1,14],[14,-2,13,-4],[12,-1,11,-3],[8,11,7,9],[6,10,5,12],[7,6],[5,8]};

%top diagrams
iteration = (L/2)-2;
Lcur = L-2*iteration;
Jmaxpos = Jmaxpos_vec(iteration+1);
    
rho{iteration,PBC_pos(Jmaxpos-1,Lcur)} = ncon({VMDH,VMDH,w{iteration+1,1},...
    w{iteration+1,2},u{iteration+1,1},u{iteration+2,1},conj(u{iteration+1,1}),...
    conj(u{iteration+2,1}),conj(w{iteration+1,1}),conj(w{iteration+1,2}),...
    conj(VMDH),conj(VMDH)},rho_at1_order);

rho{iteration,PBC_pos(Jmaxpos,Lcur)} = ncon({VMDH,VMDH,w{iteration+1,1},...
    w{iteration+1,2},u{iteration+1,1},conj(u{iteration+1,1}),...
    conj(w{iteration+1,1}),conj(w{iteration+1,2}),...
    conj(VMDH),conj(VMDH)},rho_at2_order);

rho{iteration,PBC_pos(Jmaxpos+1,Lcur)} = ncon({VMDH,VMDH,w{iteration+1,1},...
    w{iteration+1,2},u{iteration+1,1},u{iteration+2,1},conj(u{iteration+1,1}),...
    conj(u{iteration+2,1}),conj(w{iteration+1,1}),conj(w{iteration+1,2}),...
    conj(VMDH),conj(VMDH)},rho_at3_order);

rho{iteration,PBC_pos(Jmaxpos+2,Lcur)} =  ncon({VMDH,VMDH,w{iteration+1,1},...
    w{iteration+1,2},u{iteration+2,1},conj(u{iteration+2,1}),...
    conj(w{iteration+1,1}),conj(w{iteration+1,2}),...
    conj(VMDH),conj(VMDH)},rho_at4_order);

if sweep ~= 2
    %update tensors
    h = h_full(iteration,1:(L-2*(iteration-1))).';
    update_PBC(Jmaxpos_vec(iteration),iteration,optmax,ULmax,slow,epsilon,sweep,sweepmax,chi_inc(iteration));
end

%contract down
for iteration = (L/2)-3:-1:1
    
    %store current length
    Lcur = L-2*iteration;
    Jmaxpos = Jmaxpos_vec(iteration+1);
    
    %copy down unaltered
    for position = 1:Lcur
        if any(position == [PBC_pos(Jmaxpos-2,Lcur),PBC_pos(Jmaxpos-1,Lcur),Jmaxpos,PBC_pos(Jmaxpos+1,Lcur),PBC_pos(Jmaxpos+2,Lcur)]) == 0
            rho{iteration,position} = rho{iteration+1,PBC_up(position,Jmaxpos,Lcur)};
        end
    end
    
    if chi_inc(iteration+1) == 0
        %chi does not increase
        
        %middle
        rho{iteration,PBC_pos(Jmaxpos-1,Lcur)} = ncon({rho{iteration+1,PBC_up(Jmaxpos-1,Jmaxpos,Lcur)},...
            w{iteration+1,1},VMDH,w{iteration+1,2},u{iteration+1,1},conj(u{iteration+1,1}),...
            conj(w{iteration+1,1}),conj(VMDH),conj(w{iteration+1,2})},rho_m1_order);
        
        rho{iteration,PBC_pos(Jmaxpos,Lcur)} = ncon({rho{iteration+1,PBC_up(Jmaxpos,Jmaxpos,Lcur)},...
            w{iteration+1,1},VMDH,w{iteration+1,2},u{iteration+1,1},conj(u{iteration+1,1}),...
            conj(w{iteration+1,1}),conj(VMDH),conj(w{iteration+1,2})},rho_m2_order);
        
        rho{iteration,PBC_pos(Jmaxpos+1,Lcur)} = ncon({rho{iteration+1,PBC_up(Jmaxpos+1,Jmaxpos,Lcur)},...
            w{iteration+1,1},VMDH,w{iteration+1,2},u{iteration+1,1},conj(u{iteration+1,1}),...
            conj(w{iteration+1,1}),conj(VMDH),conj(w{iteration+1,2})},rho_m3_order);
        
        %left
        rho{iteration,PBC_pos(Jmaxpos-2,Lcur)} = ncon({rho{iteration+1,PBC_up(Jmaxpos-2,Jmaxpos,Lcur)},...
            w{iteration+1,1},VMDH,conj(w{iteration+1,1}),conj(VMDH)},rho_l_order);
        
        %right
        rho{iteration,PBC_pos(Jmaxpos+2,Lcur)} = ncon({rho{iteration+1,PBC_up(Jmaxpos+2,Jmaxpos,Lcur)},...
            VMDH,w{iteration+1,2},conj(w{iteration+1,2}),conj(VMDH)},rho_r_order);
        
    else
        %chi increases
        
        %middle
        rho{iteration,PBC_pos(Jmaxpos-1,Lcur)} = ncon({rho{iteration+1,PBC_up(Jmaxpos-1,Jmaxpos,Lcur)},...
            w{iteration+1,1},w{iteration+1,2},u{iteration+1,1},conj(u{iteration+1,1}),...
            conj(w{iteration+1,1}),conj(w{iteration+1,2})},rho_m1_inc_order);
        
        rho{iteration,PBC_pos(Jmaxpos,Lcur)} = ncon({rho{iteration+1,PBC_up(Jmaxpos,Jmaxpos,Lcur)},...
            w{iteration+1,1},w{iteration+1,2},u{iteration+1,1},conj(u{iteration+1,1}),...
            conj(w{iteration+1,1}),conj(w{iteration+1,2})},rho_m2_inc_order);
        
        rho{iteration,PBC_pos(Jmaxpos+1,Lcur)} = ncon({rho{iteration+1,PBC_up(Jmaxpos+1,Jmaxpos,Lcur)},...
            w{iteration+1,1},w{iteration+1,2},u{iteration+1,1},conj(u{iteration+1,1}),...
            conj(w{iteration+1,1}),conj(w{iteration+1,2})},rho_m3_inc_order);
        
        %left
        rho{iteration,PBC_pos(Jmaxpos-2,Lcur)} = ncon({rho{iteration+1,PBC_up(Jmaxpos-2,Jmaxpos,Lcur)},...
            w{iteration+1,1},conj(w{iteration+1,1})},rho_l_inc_order);
        
        %right
        rho{iteration,PBC_pos(Jmaxpos+2,Lcur)} = ncon({rho{iteration+1,PBC_up(Jmaxpos+2,Jmaxpos,Lcur)},...
            w{iteration+1,2},conj(w{iteration+1,2})},rho_r_inc_order);
    end
    
    if sweep ~= 2 && iteration ~= 1
        %update tensors
        h = h_full(iteration,1:(L-2*(iteration-1))).';
        update_PBC(Jmaxpos_vec(iteration),iteration,optmax,ULmax,slow,epsilon,sweep,sweepmax,chi_inc(iteration));
    end
    
    %force hermiticity
    rho{iteration,PBC_pos(Jmaxpos-2,Lcur)} = 0.5*(rho{iteration,PBC_pos(Jmaxpos-2,Lcur)} + conj(permute(rho{iteration,PBC_pos(Jmaxpos-2,Lcur)},[2,1,4,3])));
    rho{iteration,PBC_pos(Jmaxpos-1,Lcur)} = 0.5*(rho{iteration,PBC_pos(Jmaxpos-1,Lcur)} + conj(permute(rho{iteration,PBC_pos(Jmaxpos-1,Lcur)},[2,1,4,3])));
    rho{iteration,PBC_pos(Jmaxpos,Lcur)} = 0.5*(rho{iteration,PBC_pos(Jmaxpos,Lcur)} + conj(permute(rho{iteration,PBC_pos(Jmaxpos,Lcur)},[2,1,4,3])));
    rho{iteration,PBC_pos(Jmaxpos+1,Lcur)} = 0.5*(rho{iteration,PBC_pos(Jmaxpos+1,Lcur)} + conj(permute(rho{iteration,PBC_pos(Jmaxpos+1,Lcur)},[2,1,4,3])));
    rho{iteration,PBC_pos(Jmaxpos+2,Lcur)} = 0.5*(rho{iteration,PBC_pos(Jmaxpos+2,Lcur)} + conj(permute(rho{iteration,PBC_pos(Jmaxpos+2,Lcur)},[2,1,4,3])));
    
end
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%find optimal contraction orders
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% rho_l_netcon(netcon({[-1,-2,5,1],[1,-4,2,4],[2,3],[5,-3,6,4],[6,3]},0,2,1,1)) = 1:6;
% rho_l_order = {[-1,-2,rho_l_netcon(5),rho_l_netcon(1)],...
%     [rho_l_netcon(1),-4,rho_l_netcon(2),rho_l_netcon(4)],...
%     [rho_l_netcon(2),rho_l_netcon(3)],...
%     [rho_l_netcon(5),-3,rho_l_netcon(6),rho_l_netcon(4)],...
%     [rho_l_netcon(6),rho_l_netcon(3)]};
% 
% rho_m1_netcon(netcon({[11,1,14,2],[1,-2,3,5],[3,4],[4,6,2,7],[5,-4,6,8],[9,-3,10,8],[11,-1,12,9],[12,13],[13,10,14,7]},0,2,1,1)) = 1:14;
% rho_m1_order = {[rho_m1_netcon(11),rho_m1_netcon(1),rho_m1_netcon(14),rho_m1_netcon(2)],...
%     [rho_m1_netcon(1),-2,rho_m1_netcon(3),rho_m1_netcon(5)],...
%     [rho_m1_netcon(3),rho_m1_netcon(4)],...
%     [rho_m1_netcon(4),rho_m1_netcon(6),rho_m1_netcon(2),rho_m1_netcon(7)],...
%     [rho_m1_netcon(5),-4,rho_m1_netcon(6),rho_m1_netcon(8)],...
%     [rho_m1_netcon(9),-3,rho_m1_netcon(10),rho_m1_netcon(8)],...
%     [rho_m1_netcon(11),-1,rho_m1_netcon(12),rho_m1_netcon(9)],...
%     [rho_m1_netcon(12),rho_m1_netcon(13)],...
%     [rho_m1_netcon(13),rho_m1_netcon(10),rho_m1_netcon(14),rho_m1_netcon(7)]};
% 
% rho_m2_netcon(netcon({[11,1,14,2],[1,5,3,6],[3,4],[4,7,2,8],[6,-2,7,-4],[9,-1,10,-3],[11,5,12,9],[12,13],[13,10,14,8]},0,2,1,1)) = 1:14;
% rho_m2_order = {[rho_m2_netcon(11),rho_m2_netcon(1),rho_m2_netcon(14),rho_m2_netcon(2)],...
%     [rho_m2_netcon(1),rho_m2_netcon(5),rho_m2_netcon(3),rho_m2_netcon(6)],...
%     [rho_m2_netcon(3),rho_m2_netcon(4)],...
%     [rho_m2_netcon(4),rho_m2_netcon(7),rho_m2_netcon(2),rho_m2_netcon(8)],...
%     [rho_m2_netcon(6),-2,rho_m2_netcon(7),-4],...
%     [rho_m2_netcon(9),-1,rho_m2_netcon(10),-3],...
%     [rho_m2_netcon(11),rho_m2_netcon(5),rho_m2_netcon(12),rho_m2_netcon(9)],...
%     [rho_m2_netcon(12),rho_m2_netcon(13)],...
%     [rho_m2_netcon(13),rho_m2_netcon(10),rho_m2_netcon(14),rho_m2_netcon(8)]};
% 
% rho_m3_netcon(netcon({[11,1,14,2],[1,5,3,6],[3,4],[4,7,2,-4],[6,8,7,-2],[9,8,10,-1],[11,5,12,9],[12,13],[13,10,14,-3]},0,2,1,1)) = 1:14;
% rho_m3_order = {[rho_m3_netcon(11),rho_m3_netcon(1),rho_m3_netcon(14),rho_m3_netcon(2)],...
%     [rho_m3_netcon(1),rho_m3_netcon(5),rho_m3_netcon(3),rho_m3_netcon(6)],...
%     [rho_m3_netcon(3),rho_m3_netcon(4)],...
%     [rho_m3_netcon(4),rho_m3_netcon(7),rho_m3_netcon(2),-4],...
%     [rho_m3_netcon(6),rho_m3_netcon(8),rho_m3_netcon(7),-2],...
%     [rho_m3_netcon(9),rho_m3_netcon(8),rho_m3_netcon(10),-1],...
%     [rho_m3_netcon(11),rho_m3_netcon(5),rho_m3_netcon(12),rho_m3_netcon(9)],...
%     [rho_m3_netcon(12),rho_m3_netcon(13)],...
%     [rho_m3_netcon(13),rho_m3_netcon(10),rho_m3_netcon(14),-3]};
% 
% rho_r_netcon(netcon({[6,1,-3,-4],[2,3],[3,4,1,-2],[5,4,6,-1],[2,5]},0,2,1,1)) = 1:6;
% rho_r_order = {[rho_r_netcon(6),rho_r_netcon(1),-3,-4],...
%     [rho_r_netcon(2),rho_r_netcon(3)],...
%     [rho_r_netcon(3),rho_r_netcon(4),rho_r_netcon(1),-2],...
%     [rho_r_netcon(5),rho_r_netcon(4),rho_r_netcon(6),-1],...
%     [rho_r_netcon(2),rho_r_netcon(5)]};
% 
% rho_l_inc_netcon(netcon({[-1,-2,3,1],[1,-4,2],[3,-3,2]},0,2,1,1)) = 1:3;
% rho_l_inc_order = {[-1,-2,rho_l_inc_netcon(3),rho_l_inc_netcon(1)],...
%     [rho_l_inc_netcon(1),-4,rho_l_inc_netcon(2)],...
%     [rho_l_inc_netcon(3),-3,rho_l_inc_netcon(2)]};
% 
% rho_m1_inc_netcon(netcon({[9,1,10,2],[1,-2,3],[2,4,5],[3,-4,4,6],[7,-3,8,6],[9,-1,7],[10,8,5]},0,2,1,1)) = 1:10;
% rho_m1_inc_order = {[rho_m1_inc_netcon(9),rho_m1_inc_netcon(1),rho_m1_inc_netcon(10),rho_m1_inc_netcon(2)],...
%     [rho_m1_inc_netcon(1),-2,rho_m1_inc_netcon(3)],...
%     [rho_m1_inc_netcon(2),rho_m1_inc_netcon(4),rho_m1_inc_netcon(5)],...
%     [rho_m1_inc_netcon(3),-4,rho_m1_inc_netcon(4),rho_m1_inc_netcon(6)],...
%     [rho_m1_inc_netcon(7),-3,rho_m1_inc_netcon(8),rho_m1_inc_netcon(6)],...
%     [rho_m1_inc_netcon(9),-1,rho_m1_inc_netcon(7)],...
%     [rho_m1_inc_netcon(10),rho_m1_inc_netcon(8),rho_m1_inc_netcon(5)]};
% 
% rho_m2_inc_netcon(netcon({[9,1,10,2],[1,3,4],[2,5,6],[4,-2,5,-4],[7,-1,8,-3],[9,3,7],[10,8,6]},0,2,1,1)) = 1:10;
% rho_m2_inc_order = {[rho_m2_inc_netcon(9),rho_m2_inc_netcon(1),rho_m2_inc_netcon(10),rho_m2_inc_netcon(2)],...
%     [rho_m2_inc_netcon(1),rho_m2_inc_netcon(3),rho_m2_inc_netcon(4)],...
%     [rho_m2_inc_netcon(2),rho_m2_inc_netcon(5),rho_m2_inc_netcon(6)],...
%     [rho_m2_inc_netcon(4),-2,rho_m2_inc_netcon(5),-4],...
%     [rho_m2_inc_netcon(7),-1,rho_m2_inc_netcon(8),-3],...
%     [rho_m2_inc_netcon(9),rho_m2_inc_netcon(3),rho_m2_inc_netcon(7)],...
%     [rho_m2_inc_netcon(10),rho_m2_inc_netcon(8),rho_m2_inc_netcon(6)]};
% 
% rho_m3_inc_netcon(netcon({[9,1,10,2],[1,3,4],[2,5,-4],[4,6,5,-2],[7,6,8,-1],[9,3,7],[10,8,-3]},0,2,1,1)) = 1:10;
% rho_m3_inc_order = {[rho_m3_inc_netcon(9),rho_m3_inc_netcon(1),rho_m3_inc_netcon(10),rho_m3_inc_netcon(2)],...
%     [rho_m3_inc_netcon(1),rho_m3_inc_netcon(3),rho_m3_inc_netcon(4)],...
%     [rho_m3_inc_netcon(2),rho_m3_inc_netcon(5),-4],...
%     [rho_m3_inc_netcon(4),rho_m3_inc_netcon(6),rho_m3_inc_netcon(5),-2],...
%     [rho_m3_inc_netcon(7),rho_m3_inc_netcon(6),rho_m3_inc_netcon(8),-1],...
%     [rho_m3_inc_netcon(9),rho_m3_inc_netcon(3),rho_m3_inc_netcon(7)],...
%     [rho_m3_inc_netcon(10),rho_m3_inc_netcon(8),-3]};
% 
% rho_r_inc_netcon(netcon({[3,1,-3,-4],[1,2,-2],[3,2,-1]},0,2,1,1)) = 1:3;
% rho_r_inc_order = {[rho_r_inc_netcon(3),rho_r_inc_netcon(1),-3,-4],...
%     [rho_r_inc_netcon(1),rho_r_inc_netcon(2),-2],...
%     [rho_r_inc_netcon(3),rho_r_inc_netcon(2),-1]};
%
% rho_at1_netcon(netcon({[1,2],[3,4],[4,5,1,6],[2,7,3,8],[6,-4,7,9],[8,10,5,-2],[12,-3,13,9],[14,10,11,-1],[18,11,15,12],[16,13,17,14],[15,16],[17,18]},0,2,1,1)) = 1:18;
% rho_at1_order = {[rho_at1_netcon(1),rho_at1_netcon(2)],...
%     [rho_at1_netcon(3),rho_at1_netcon(4)],...
%     [rho_at1_netcon(4),rho_at1_netcon(5),rho_at1_netcon(1),rho_at1_netcon(6)],...
%     [rho_at1_netcon(2),rho_at1_netcon(7),rho_at1_netcon(3),rho_at1_netcon(8)],...
%     [rho_at1_netcon(6),-4,rho_at1_netcon(7),rho_at1_netcon(9)],...
%     [rho_at1_netcon(8),rho_at1_netcon(10),rho_at1_netcon(5),-2],....
%     [rho_at1_netcon(12),-3,rho_at1_netcon(13),rho_at1_netcon(9)],...
%     [rho_at1_netcon(14),rho_at1_netcon(10),rho_at1_netcon(11),-1],...
%     [rho_at1_netcon(18),rho_at1_netcon(11),rho_at1_netcon(15),rho_at1_netcon(12)],...
%     [rho_at1_netcon(16),rho_at1_netcon(13),rho_at1_netcon(17),rho_at1_netcon(14)],...
%     [rho_at1_netcon(15),rho_at1_netcon(16)],[rho_at1_netcon(17),rho_at1_netcon(18)]};
% 
% rho_at2_netcon(netcon({[1,2],[3,4],[4,5,1,6],[2,7,3,8],[6,-2,7,-4],[9,-1,10,-3],[14,5,11,9],[12,10,13,8],[11,12],[13,14]},0,2,1,1)) = 1:14;
% rho_at2_order = {[rho_at2_netcon(1),rho_at2_netcon(2)],...
%     [rho_at2_netcon(3),rho_at2_netcon(4)],...
%     [rho_at2_netcon(4),rho_at2_netcon(5),rho_at2_netcon(1),rho_at2_netcon(6)],...
%     [rho_at2_netcon(2),rho_at2_netcon(7),rho_at2_netcon(3),rho_at2_netcon(8)],...
%     [rho_at2_netcon(6),-2,rho_at2_netcon(7),-4],...
%     [rho_at2_netcon(9),-1,rho_at2_netcon(10),-3],...
%     [rho_at2_netcon(14),rho_at2_netcon(5),rho_at2_netcon(11),rho_at2_netcon(9)],...
%     [rho_at2_netcon(12),rho_at2_netcon(10),rho_at2_netcon(13),rho_at2_netcon(8)],...
%     [rho_at2_netcon(11),rho_at2_netcon(12)],...
%     [rho_at2_netcon(13),rho_at2_netcon(14)]};
% 
% rho_at3_netcon(netcon({[1,2],[3,4],[4,5,1,6],[2,7,3,8],[6,10,7,-2],[8,-4,5,9],[12,10,13,-1],[14,-3,11,9],[18,11,15,12],[16,13,17,14],[15,16],[17,18]},0,2,1,1)) = 1:18;
% rho_at3_order = {[rho_at3_netcon(1),rho_at3_netcon(2)],...
%     [rho_at3_netcon(3),rho_at3_netcon(4)],...
%     [rho_at3_netcon(4),rho_at3_netcon(5),rho_at3_netcon(1),rho_at3_netcon(6)],...
%     [rho_at3_netcon(2),rho_at3_netcon(7),rho_at3_netcon(3),rho_at3_netcon(8)],...
%     [rho_at3_netcon(6),rho_at3_netcon(10),rho_at3_netcon(7),-2],...
%     [rho_at3_netcon(8),-4,rho_at3_netcon(5),rho_at3_netcon(9)],...
%     [rho_at3_netcon(12),rho_at3_netcon(10),rho_at3_netcon(13),-1],...
%     [rho_at3_netcon(14),-3,rho_at3_netcon(11),rho_at3_netcon(9)],...
%     [rho_at3_netcon(18),rho_at3_netcon(11),rho_at3_netcon(15),rho_at3_netcon(12)],...
%     [rho_at3_netcon(16),rho_at3_netcon(13),rho_at3_netcon(17),rho_at3_netcon(14)],...
%     [rho_at3_netcon(15),rho_at3_netcon(16)],...
%     [rho_at3_netcon(17),rho_at3_netcon(18)]};
% 
% rho_at4_netcon(netcon({[1,2],[3,4],[4,5,1,6],[2,7,3,8],[8,-2,5,-4],[10,-1,9,-3],[14,9,11,6],[12,7,13,10],[11,12],[13,14]},0,2,1,1)) = 1:14;
% rho_at4_order = {[rho_at4_netcon(1),rho_at4_netcon(2)],...
%     [rho_at4_netcon(3),rho_at4_netcon(4)],...
%     [rho_at4_netcon(4),rho_at4_netcon(5),rho_at4_netcon(1),rho_at4_netcon(6)],...
%     [rho_at4_netcon(2),rho_at4_netcon(7),rho_at4_netcon(3),rho_at4_netcon(8)],...
%     [rho_at4_netcon(8),-2,rho_at4_netcon(5),-4],...
%     [rho_at4_netcon(10),-1,rho_at4_netcon(9),-3],...
%     [rho_at4_netcon(14),rho_at4_netcon(9),rho_at4_netcon(11),rho_at4_netcon(6)],...
%     [rho_at4_netcon(12),rho_at4_netcon(7),rho_at4_netcon(13),rho_at4_netcon(10)],...
%     [rho_at4_netcon(11),rho_at4_netcon(12)],...
%     [rho_at4_netcon(13),rho_at4_netcon(14)]};